<!DOCTYPE html>
<html>
  <head>
    <title>Meiosis Tutorial</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="normalize.css">
    <link rel="stylesheet" href="skeleton.css">
    <link rel="stylesheet" href="prism.css">
    <link rel="stylesheet" href="style.css">
  </head>
  <body class="container">
    <script src="prism.js" type="text/javascript"></script>
    <script src="flems.html" type="text/javascript" charset="utf-8"></script>
    <h1><a href="https://meiosis.js.org">Meiosis</a> Tutorial</h1><p><a href="09-using-preact.html">&lt; Previous</a> |
<a href="11-whats-next.html">Next &gt;</a> |
<a href="toc.html">Table of Contents</a></p>
<h2>10 - Using lit-html</h2><p>In the <a href="06-components.html">06 - Components</a> lesson, we created the state management
code for an example with a <code>conditions</code> component and two temperature components, <code>air</code> and
<code>water</code>.</p>
<p>In this section, we&#39;ll wire this up to <a href="https://lit-html.polymer-project.org/">lit-html</a>.</p>
<p><a name="wiring_meiosis"></a></p>
<h3><a href="#wiring_meiosis">Wiring Meiosis</a></h3><p>Remember that we had an <code>actions</code> object and a <code>states</code> stream:</p>
<pre><code class="language-js">var actions = app.Actions(update);
states.map(function(state) {
  document.write(&quot;&lt;pre&gt;&quot; + JSON.stringify(state, null, 2) + &quot;&lt;/pre&gt;&quot;);
});</code></pre>
<p>Now, we&#39;ll use lit-html&#39;s <code>render</code> and a view function to render the view. We&#39;ll use <code>map</code>
on the <code>states</code> stream, and render the view every time the state changes. We&#39;ll pass <code>state</code>
and <code>actions</code> as parameters to the <code>App</code> view function:</p>
<pre><code class="language-js">var element = document.getElementById(&quot;app&quot;);
states.map(state =&gt; render(App(state, actions), element));</code></pre>
<p><a name="the_app_view_function"></a></p>
<h3><a href="#the_app_view_function">The App View Function</a></h3><p>The <code>App</code> view function receives <code>state</code> and <code>actions</code> as parameters. We pass these on to other
view functions, in this case <code>Conditions</code> and <code>Temperature</code>. Notice that we have two instances
of <code>Temperature</code>, and we also pass a different <code>id</code> to each one.</p>
<pre><code class="language-js">var App = function(state, actions) {
  return html`&lt;div&gt;
    ${Conditions({ state, id: &quot;conditions&quot;, actions })}
    ${Temperature({ state, id: &quot;temperature:air&quot;, actions })}
    ${Temperature({ state, id: &quot;temperature:water&quot;, actions })}
    &lt;pre&gt;${JSON.stringify(state, null, 4)}&lt;/pre&gt;
  &lt;/div&gt;`;
};</code></pre>
<p><a name="the_conditions_view_function"></a></p>
<h3><a href="#the_conditions_view_function">The Conditions View Function</a></h3><p>The <code>Conditions</code> view function displays a checkbox for &quot;precipitations&quot; and a series of radio
butons for the sky (Sunny, Cloudy, Mix of sun/clouds). The <code>state</code> is used to reflect the
current state, and <code>actions</code> are called to update the state when the user changes the
checkbox and radio buttons:</p>
<pre><code class="language-js">var skyOption = function({ state, id, actions, value, label }) {
  return html`&lt;label&gt;
    &lt;input type=&quot;radio&quot; id=${value} name=&quot;sky&quot;
      value=${value} .checked=${state[id].sky === value}
      @change=${evt =&gt; actions.changeSky(id, evt.target.value)}/&gt;
    ${label}
  &lt;/label&gt;`;
};

var Conditions = function({ state, id, actions }) {
  return html`&lt;div&gt;
    &lt;label&gt;
      &lt;input
        type=&quot;checkbox&quot;
        .checked=${state[id].precipitations}
        @change=${evt =&gt;
          actions.togglePrecipitations(id, evt.target.checked)
        }/&gt;
      Precipitations
    &lt;/label&gt;
    &lt;div&gt;
      ${skyOption({ state, id, actions, value: &quot;SUNNY&quot;,
        label: &quot;Sunny&quot;})}
      ${skyOption({ state, id, actions, value: &quot;CLOUDY&quot;,
        label: &quot;Cloudy&quot;})}
      ${skyOption({ state, id, actions, value: &quot;MIX&quot;,
        label: &quot;Mix of sun/clouds&quot;})}
    &lt;/div&gt;
  &lt;/div&gt;`;
};</code></pre>
<p><a name="the_temperature_view_function"></a></p>
<h3><a href="#the_temperature_view_function">The Temperature View Function</a></h3><p>The <code>Temperature</code> view function is similar:</p>
<pre><code class="language-js">var Temperature = function({ state, id, actions }) {
  return html`&lt;div&gt;
    ${state[id].label} Temperature:
    ${state[id].value} &amp;deg; ${state[id].units}
    &lt;div&gt;
      &lt;button
        @click=${() =&gt; actions.increment(id, 1)}&gt;
        Increment
      &lt;/button&gt;
      &lt;button
        @click=${() =&gt; actions.increment(id,-1)}&gt;
        Decrement
      &lt;/button&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button
        @click=${() =&gt; actions.changeUnits(id)}&gt;
        Change Units
      &lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;`;
};</code></pre>
<p>You can see the complete example below.</p>
<div id="flems1" class="flemscode" style="height:800px"></div>
  <script>
    window.Flems(flems1, {
      files: [{name: "10-using-lit-html-01.js", content: "import {\n  html,\n  render\n} from \"https://unpkg.com/lit-html?module\";\n\n/*global flyd, mergerino*/\nconst merge = mergerino;\n\nvar conditions = {\n  initial: {\n    precipitations: false,\n    sky: \"Sunny\"\n  },\n  Actions: function (update) {\n    return {\n      togglePrecipitations: function (id, value) {\n        update({ [id]: { precipitations: value } });\n      },\n      changeSky: function (id, value) {\n        update({ [id]: { sky: value } });\n      }\n    };\n  }\n};\n\nvar skyOption = function ({\n  state,\n  id,\n  actions,\n  value,\n  label\n}) {\n  return html`\n    <label>\n      <input\n        type=\"radio\"\n        id=${value}\n        name=\"sky\"\n        value=${value}\n        .checked=${state[id].sky === value}\n        @change=${evt =>\n          actions.changeSky(id, evt.target.value)}\n      />\n      ${label}\n    </label>\n  `;\n};\n\nvar Conditions = function ({ state, id, actions }) {\n  return html`\n    <div>\n      <label>\n        <input\n          type=\"checkbox\"\n          .checked=${state[id].precipitations}\n          @change=${evt =>\n            actions.togglePrecipitations(\n              id,\n              evt.target.checked\n            )}\n        />\n        Precipitations\n      </label>\n      <div>\n        ${skyOption({\n          state,\n          id,\n          actions,\n          value: \"SUNNY\",\n          label: \"Sunny\"\n        })}\n        ${skyOption({\n          state,\n          id,\n          actions,\n          value: \"CLOUDY\",\n          label: \"Cloudy\"\n        })}\n        ${skyOption({\n          state,\n          id,\n          actions,\n          value: \"MIX\",\n          label: \"Mix of sun/clouds\"\n        })}\n      </div>\n    </div>\n  `;\n};\n\nvar convert = function (value, to) {\n  return Math.round(\n    to === \"C\" ? ((value - 32) / 9) * 5 : (value * 9) / 5 + 32\n  );\n};\n\nvar temperature = {\n  Initial: function (label) {\n    return {\n      label,\n      value: 22,\n      units: \"C\"\n    };\n  },\n  Actions: function (update) {\n    return {\n      increment: function (id, amount) {\n        update({ [id]: { value: x => x + amount } });\n      },\n      changeUnits: function (id) {\n        update({\n          [id]: state => {\n            var value = state.value;\n            var newUnits = state.units === \"C\" ? \"F\" : \"C\";\n            var newValue = convert(value, newUnits);\n            state.value = newValue;\n            state.units = newUnits;\n            return state;\n          }\n        });\n      }\n    };\n  }\n};\n\nvar Temperature = function ({ state, id, actions }) {\n  return html`\n    <div>\n      ${state[id].label} Temperature: ${state[id].value} &deg;\n      ${state[id].units}\n      <div>\n        <button @click=${() => actions.increment(id, 1)}>\n          Increment\n        </button>\n        <button @click=${() => actions.increment(id, -1)}>\n          Decrement\n        </button>\n      </div>\n      <div>\n        <button @click=${() => actions.changeUnits(id)}>\n          Change Units\n        </button>\n      </div>\n    </div>\n  `;\n};\n\nvar app = {\n  initial: {\n    conditions: conditions.initial,\n    \"temperature:air\": temperature.Initial(\"Air\"),\n    \"temperature:water\": temperature.Initial(\"Water\")\n  },\n  Actions: function (update) {\n    return Object.assign(\n      {},\n      conditions.Actions(update),\n      temperature.Actions(update)\n    );\n  }\n};\n\nvar App = function (state, actions) {\n  return html`\n    <div>\n      ${Conditions({ state, id: \"conditions\", actions })}\n      ${Temperature({ state, id: \"temperature:air\", actions })}\n      ${Temperature({\n        state,\n        id: \"temperature:water\",\n        actions\n      })}\n      <pre>${JSON.stringify(state, null, 4)}</pre>\n    </div>\n  `;\n};\n\nvar update = flyd.stream();\nvar states = flyd.scan(merge, app.initial, update);\n\nvar actions = app.Actions(update);\nvar element = document.getElementById(\"app\");\nstates.map(state => render(App(state, actions), element));\n"},{name: "app.html", content: "<div id=\"app\"></div>\n"},{name: "app.css", content: "body, button {\n  font-family: sans-serif;\n  font-size: 1rem;\n}\nbutton, button.light {\n  cursor: pointer;\n  padding: 2px 8px 2px 8px;\n  color: #5755d9;\n  background-color: #ffffff;\n  border: 1px solid #5755d9;\n  margin: 4px;\n}\nbutton:hover {\n  background-color: #eeeeee;\n}\nbutton.dark {\n  background-color: #5755d9;\n  color: #ffffff;\n}\nbutton.dark:hover {\n  background-color: #7775f9;\n}\n.temperature, .humidity {\n  margin-bottom: 20px;\n}\ninput {\n  margin-right: 4px;\n}\nlabel {\n  margin-right: 8px;\n}\n"}],
      links: [{name: "flyd", type: "js", url: "https://unpkg.com/flyd@0.2.8/flyd.js"},{name: "mergerino", type: "js", url: "https://unpkg.com/mergerino@0.4.0"}],
      middle: 60
    })
  </script>


<p><a name="takeaways"></a></p>
<h3><a href="#takeaways">Takeaways</a></h3><p>We can wire up Meiosis to lit-html using <code>render</code> and passing <code>state</code> and <code>actions</code> as
parameters to the top-level <code>App</code> view function. We call <code>map</code> on the <code>states</code> stream to
render the view whenever the state changes.</p>
<p>Then, all view functions in the application are consistent: they all receive <code>state</code>
and <code>actions</code> parameters. When calling other view functions, <code>state</code> and <code>actions</code> are passed
along. When a view function is used multiple times, or when you want to define the state
property outside of the view function, you also pass the <code>id</code>.</p>
<p>View functions can then use the <code>state</code> to render the view according to the current application
state, and call <code>actions</code> to trigger changes.</p>
<p><a name="conclusion"></a></p>
<h3><a href="#conclusion">Conclusion</a></h3><p>This concludes the Meiosis tutorial. See <a href="11-whats-next.html">11 - What&#39;s Next?</a> for ideas on where
to go from here.</p>
<p><a href="09-using-preact.html">&lt; Previous</a> |
<a href="11-whats-next.html">Next &gt;</a> |
<a href="toc.html">Table of Contents</a></p>
<hr>
<p><a href="https://meiosis.js.org">Meiosis</a> is developed by <a href="http://twitter.com/foxdonut00">@foxdonut00</a> / <a href="https://github.com/foxdonut">foxdonut</a> and is released under the MIT license.</p>
  </body>
</html>
<!DOCTYPE html>
<html>
  <head>
    <title>Meiosis Tutorial</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="normalize.css">
    <link rel="stylesheet" href="skeleton.css">
    <link rel="stylesheet" href="prism.css">
    <link rel="stylesheet" href="style.css">
  </head>
  <body class="container">
    <script src="prism.js" type="text/javascript"></script>
    <script src="flems.html" type="text/javascript" charset="utf-8"></script>
    <h1><a href="https://meiosis.js.org">Meiosis</a> Tutorial</h1><p><a href="08-using-react.html">&lt; Previous</a> |
<a href="10-using-lit-html.html">Next &gt;</a> |
<a href="toc.html">Table of Contents</a></p>
<h2>09 - Using Preact</h2><p>In the <a href="06-components.html">06 - Components</a> lesson, we created the state management
code for an example with a <code>conditions</code> component and two temperature components, <code>air</code> and
<code>water</code>.</p>
<p>In this section, we&#39;ll wire this up to <a href="https://preactjs.com/">Preact</a>.</p>
<p><a name="wiring_meiosis"></a></p>
<h3><a href="#wiring_meiosis">Wiring Meiosis</a></h3><p>Remember that we had an <code>actions</code> object and a <code>states</code> stream:</p>
<pre><code class="language-js">var actions = app.Actions(update);
states.map(function(state) {
  document.write(&quot;&lt;pre&gt;&quot; + JSON.stringify(state, null, 2) + &quot;&lt;/pre&gt;&quot;);
});</code></pre>
<p>Now, we&#39;ll use <code>preact.render</code> and a Preact component to render the view. We&#39;ll pass the
<code>actions</code> and <code>states</code> props to a top-level <code>App</code> component:</p>
<pre><code class="language-js">preact.render(&lt;App states={states} actions={actions} /&gt;,
  document.getElementById(&quot;app&quot;));</code></pre>
<p>Within the <code>App</code> component, we&#39;ll use <code>map</code> on the <code>states</code> stream and call <code>setState</code> so
that the view gets refreshed whenever the state changes.</p>
<p><a name="the_app_component"></a></p>
<h3><a href="#the_app_component">The App Component</a></h3><p>The <code>App</code> component retrieves <code>states</code> and <code>actions</code> from the passed-in props. We initialize a
Preact hook with <code>useState</code> from the first value of the <code>states</code> stream. Then, we <code>map</code> the <code>states</code>
stream and call <code>setState</code> to set the hook state.</p>
<pre><code class="language-js">var App = function({ states, actions }) {
  var [state, setState] = preactHooks.useState(states());
  states.map(setState);

  return (
    &lt;div&gt;
      &lt;Conditions state={state} id=&quot;conditions&quot; actions={actions} /&gt;
      &lt;Temperature state={state} id=&quot;temperature:air&quot; actions={actions} /&gt;
      &lt;Temperature state={state} id=&quot;temperature:water&quot; actions={actions} /&gt;
      &lt;pre&gt;{JSON.stringify(state, null, 4)}&lt;/pre&gt;
    &lt;/div&gt;
  );
}</code></pre>
<p><a name="the_conditions_component"></a></p>
<h3><a href="#the_conditions_component">The Conditions Component</a></h3><p>The <code>Conditions</code> component displays a checkbox for &quot;precipitations&quot; and a series of radio
butons for the sky (Sunny, Cloudy, Mix of sun/clouds). The <code>state</code> is used to reflect the
current state, and <code>actions</code> are called to update the state when the user changes the
checkbox and radio buttons:</p>
<pre><code class="language-js">var SkyOption = function({ state, id, actions, value, label }) {
  return (&lt;label&gt;
    &lt;input type=&quot;radio&quot; id={value} name=&quot;sky&quot;
      value={value} checked={state[id].sky === value}
      onChange={evt =&gt; actions.changeSky(id, evt.target.value)}/&gt;
    {label}
  &lt;/label&gt;);
};

var Conditions = function({ state, id, actions }) {
  return (&lt;div&gt;
    &lt;label&gt;
      &lt;input
        type=&quot;checkbox&quot;
        checked={state[id].precipitations}
        onChange={evt =&gt;
          actions.togglePrecipitations(id, evt.target.checked)
        }/&gt;
      Precipitations
    &lt;/label&gt;
    &lt;div&gt;
      &lt;SkyOption state={state} id={id} actions={actions} value=&quot;SUNNY&quot;
        label=&quot;Sunny&quot;/&gt;
      &lt;SkyOption state={state} id={id} actions={actions} value=&quot;CLOUDY&quot;
        label=&quot;Cloudy&quot;/&gt;
      &lt;SkyOption state={state} id={id} actions={actions} value=&quot;MIX&quot;
        label=&quot;Mix of sun/clouds&quot;/&gt;
    &lt;/div&gt;
  &lt;/div&gt;);
};</code></pre>
<p><a name="the_temperature_component"></a></p>
<h3><a href="#the_temperature_component">The Temperature Component</a></h3><p>The <code>Temperature</code> component is similar:</p>
<pre><code class="language-js">var Temperature = function({ state, id, actions }) {
  return (&lt;div&gt;
    {state[id].label} Temperature:
    {state[id].value} &amp;deg; {state[id].units}
    &lt;div&gt;
      &lt;button
        onClick={() =&gt; actions.increment(id, 1)}&gt;
        Increment
      &lt;/button&gt;
      &lt;button
        onClick={() =&gt; actions.increment(id,-1)}&gt;
        Decrement
      &lt;/button&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button
        onClick={() =&gt; actions.changeUnits(id)}&gt;
        Change Units
      &lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;);
};</code></pre>
<p>You can see the complete example below.</p>
<div id="flems1" class="flemscode" style="height:800px"></div>
  <script>
    window.Flems(flems1, {
      files: [{name: "09-using-preact-01.js", content: "/*global preact, preactHooks, flyd, mergerino*/\n/** @jsx preact.h */\nconst merge = mergerino;\n\nvar conditions = {\n  initial: {\n    precipitations: false,\n    sky: \"Sunny\"\n  },\n  Actions: function(update) {\n    return {\n      togglePrecipitations: function(id, value) {\n        update({ [id]: { precipitations: value } });\n      },\n      changeSky: function(id, value) {\n        update({ [id]: { sky: value } });\n      }\n    };\n  }\n};\n\nvar SkyOption = function({ state, id, actions, value, label }) {\n  return (\n    <label>\n      <input\n        type=\"radio\"\n        id={value}\n        name=\"sky\"\n        value={value}\n        checked={state[id].sky === value}\n        onChange={evt =>\n          actions.changeSky(id, evt.target.value)\n        }\n      />\n      {label}\n    </label>\n  );\n};\n\nvar Conditions = function({ state, id, actions }) {\n  return (\n    <div>\n      <label>\n        <input\n          type=\"checkbox\"\n          checked={state[id].precipitations}\n          onChange={evt =>\n            actions.togglePrecipitations(id, evt.target.checked)\n          }\n        />\n        Precipitations\n      </label>\n      <div>\n        <SkyOption\n          state={state}\n          id={id}\n          actions={actions}\n          value=\"SUNNY\"\n          label=\"Sunny\"\n        />\n        <SkyOption\n          state={state}\n          id={id}\n          actions={actions}\n          value=\"CLOUDY\"\n          label=\"Cloudy\"\n        />\n        <SkyOption\n          state={state}\n          id={id}\n          actions={actions}\n          value=\"MIX\"\n          label=\"Mix of sun/clouds\"\n        />\n      </div>\n    </div>\n  );\n};\n\nvar convert = function(value, to) {\n  return Math.round(\n    to === \"C\" ? ((value - 32) / 9) * 5 : (value * 9) / 5 + 32\n  );\n};\n\nvar temperature = {\n  Initial: function(label) {\n    return {\n      label,\n      value: 22,\n      units: \"C\"\n    };\n  },\n  Actions: function(update) {\n    return {\n      increment: function(id, amount) {\n        update({ [id]: { value: x => x + amount } });\n      },\n      changeUnits: function(id) {\n        update({\n          [id]: state => {\n            var value = state.value;\n            var newUnits = state.units === \"C\" ? \"F\" : \"C\";\n            var newValue = convert(value, newUnits);\n            state.value = newValue;\n            state.units = newUnits;\n            return state;\n          }\n        });\n      }\n    };\n  }\n};\n\nvar Temperature = function({ state, id, actions }) {\n  return (\n    <div>\n      {state[id].label} Temperature:\n      {state[id].value} &deg; {state[id].units}\n      <div>\n        <button onClick={() => actions.increment(id, 1)}>\n          Increment\n        </button>\n        <button onClick={() => actions.increment(id, -1)}>\n          Decrement\n        </button>\n      </div>\n      <div>\n        <button onClick={() => actions.changeUnits(id)}>\n          Change Units\n        </button>\n      </div>\n    </div>\n  );\n};\n\nvar app = {\n  initial: {\n    conditions: conditions.initial,\n    \"temperature:air\": temperature.Initial(\"Air\"),\n    \"temperature:water\": temperature.Initial(\"Water\")\n  },\n  Actions: function(update) {\n    return Object.assign(\n      {},\n      conditions.Actions(update),\n      temperature.Actions(update)\n    );\n  }\n};\n\nvar App = function({ states, actions }) {\n  var [state, setState] = preactHooks.useState(states());\n  states.map(setState);\n\n  return (\n    <div>\n      <Conditions\n        state={state}\n        id=\"conditions\"\n        actions={actions}\n      />\n      <Temperature\n        state={state}\n        id=\"temperature:air\"\n        actions={actions}\n      />\n      <Temperature\n        state={state}\n        id=\"temperature:water\"\n        actions={actions}\n      />\n      <pre>{JSON.stringify(state, null, 4)}</pre>\n    </div>\n  );\n};\n\nvar update = flyd.stream();\nvar states = flyd.scan(merge, app.initial, update);\nvar actions = app.Actions(update);\n\n// eslint-disable-next-line react/no-deprecated\npreact.render(\n  <App states={states} actions={actions} />,\n  document.getElementById(\"app\")\n);\n", compiler: "babel"},{name: "app.html", content: "<div id=\"app\"></div>\n"},{name: "app.css", content: "body, button {\n  font-family: sans-serif;\n  font-size: 1rem;\n}\nbutton, button.light {\n  cursor: pointer;\n  padding: 2px 8px 2px 8px;\n  color: #5755d9;\n  background-color: #ffffff;\n  border: 1px solid #5755d9;\n  margin: 4px;\n}\nbutton:hover {\n  background-color: #eeeeee;\n}\nbutton.dark {\n  background-color: #5755d9;\n  color: #ffffff;\n}\nbutton.dark:hover {\n  background-color: #7775f9;\n}\n.temperature, .humidity {\n  margin-bottom: 20px;\n}\ninput {\n  margin-right: 4px;\n}\nlabel {\n  margin-right: 8px;\n}\n"}],
      links: [{name: "flyd", type: "js", url: "https://unpkg.com/flyd@0.2.8/flyd.js"},{name: "preact", type: "js", url: "https://unpkg.com/preact@10.3.4/dist/preact.umd.js"},{name: "preactHooks", type: "js", url: "https://unpkg.com/preact@10.3.4/hooks/dist/hooks.umd.js"},{name: "mergerino", type: "js", url: "https://unpkg.com/mergerino@0.4.0"}],
      middle: 60
    })
  </script>


<h3><a href="#takeaways">Takeaways</a></h3><p>We can wire up Meiosis to Preact with a hook. We <code>map</code> the <code>states</code> stream to call <code>setState</code> to
update the state and automatically refresh the view.</p>
<p>Then, all other Preact components in the application are consistent: they all receive <code>state</code>
and <code>actions</code> props. When rendering other components, <code>state</code> and <code>actions</code> are passed along.
When a component is used multiple times, or when you want to define the state property outside of
the component, you also pass the <code>id</code>.</p>
<p>Components can then use the <code>state</code> to render the view according to the current application
state, and call <code>actions</code> to trigger changes.</p>
<p><a name="conclusion"></a></p>
<h3><a href="#conclusion">Conclusion</a></h3><p>This concludes the Meiosis tutorial. See <a href="11-whats-next.html">11 - What&#39;s Next?</a> for ideas on where
to go from here.</p>
<p><a href="08-using-react.html">&lt; Previous</a> |
<a href="10-using-lit-html.html">Next &gt;</a> |
<a href="toc.html">Table of Contents</a></p>
<hr>
<p><a href="https://meiosis.js.org">Meiosis</a> is developed by <a href="http://twitter.com/foxdonut00">@foxdonut00</a> / <a href="https://github.com/foxdonut">foxdonut</a> and is released under the MIT license.</p>
  </body>
</html>